import{m as _}from"./axios-e7133cbe.js";import{r as K,o as d,c as p,a as e,w as t,e as u,b as m,V as x,d as U,F as y,f as V,k as v,l as b,t as k,j as R,a8 as C,a9 as T}from"./main-30c8eb33.js";import{_ as H}from"./_plugin-vue_export-helper-c27b6911.js";import{V as F,a as O,c as G}from"./VCard-c43b9302.js";import{V as D}from"./VTextField-d62e5fe1.js";import{V as M}from"./VDialog-97eb01a0.js";import{V as A}from"./VForm-039257e4.js";import{V as g,a as n}from"./VRow-185b4e6d.js";import{V as I}from"./VSelect-ae27591c.js";import{V as E}from"./VTextarea-1b814101.js";import{V as N}from"./VFileInput-d39c5af0.js";import{V as B}from"./VDivider-b7bed146.js";import{V as q}from"./VCheckbox-362d286d.js";import{b as L,c as z}from"./VMenu-d0b879ac.js";import{a as P,V as w}from"./VChip-8bba0d1c.js";import{V as S}from"./VTooltip-b9c51e0b.js";import"./VAvatar-2cdfccff.js";import"./VImg-e9cc557b.js";import"./VCounter-55ae2343.js";import"./index-00771475.js";import"./VOverlay-63a8e55f.js";import"./dialog-transition-239f7885.js";import"./VCheckboxBtn-57fdc3fe.js";const Q={watch:{positions:{handler(a){this.selectedPositions=a.filter(l=>l.checked).map(({title:l,value:i})=>({title:l,value:i}))},deep:!0}},data(){return{insert:!1,edit:!1,filePath:this.$filePath,rules:{required:a=>!!a||"Required"},rulesTextArea:[a=>a.length<=2048||"Max 2048 characters"],items:[],headers:[{text:"Pengunggah",value:"author.name",sortable:!0},{text:"File Name",value:"name",sortable:!0},{text:"Jabatan",value:"positions",sortable:!0},{text:"Kategori",value:"categories",sortable:!0},{text:"File",value:"path",sortable:!0},{text:"Tanggal Diupload",value:"created_at",sortable:!0},{text:"Operation    ",value:"operation"}],searchValue:"",searchField:["name","author.name","email","divisions","positions","categories"],dataForm:{id:null,name:null,path:null,summary:"",positions:[],categories:[]},positions:[],categories:[],selectedPositions:[],selectedCategories:[]}},methods:{toCategoryId(a){this.$router.push(`/a-percategory/${a}`)},toPositionId(a){this.$router.push(`/a-perposition/${a}`)},toDetailFile(a){this.$router.push(`/a-filedetail/${a.id}`)},toLink(a){this.$router.push(`/${a}`)},async updateData(){try{const a=new FormData;a.append("id",this.dataForm.id),a.append("name",this.dataForm.name),a.append("summary",this.dataForm.summary),this.dataForm.path!==null&&a.append("path",this.dataForm.path),this.dataForm.positions=this.selectedPositions.map(i=>i.value),this.dataForm.positions!==null&&this.dataForm.positions.forEach(i=>{a.append("positions[]",i)}),this.dataForm.categories!==null&&this.dataForm.categories.forEach(i=>{a.append("categories[]",i)}),a.append("_method","PUT");const l=await _.post(`/file/${this.dataForm.id}`,a,{headers:{"Content-Type":"multipart/form-data"}});l.status===200?(this.closeModal(2),this.getAllFiles(),this.$showToast("success","Success",l.data.message)):(this.closeModal(2),this.getAllFiles(),this.$showToast("error","Sorry",l.data.message))}catch{this.closeModal(2),this.getAllFiles(),this.$showToast("error","Sorry","error get data division")}},async deleteFile(a){try{if(!window.confirm("Semua Data yang terkait akan ikut terhapus. Apakah Anda yakin ingin menghapus data?"))return;const i=await _.delete(`/file/${a.id}`);i.status===200?(this.getAllFiles(),this.$showToast("success","Berhasil",i.data.message)):this.$showToast("error","Sorry",i.data.message)}catch(l){this.$showToast("error","Sorry",l.response.data.message)}},async insertData(){try{for(let i in this.dataForm)i!=="id"&&this.dataForm[i]===null&&(this.closeModal(1),this.$showToast("error","Sorry",`Properti ${i} harus diisi.`));const a=new FormData;for(let i in this.dataForm)i!=="id"&&i!=="positions"&&i!=="categories"&&a.append(i,this.dataForm[i]);this.dataForm.positions=this.selectedPositions.map(i=>i.value),this.dataForm.positions.forEach(i=>{a.append("positions[]",i)}),this.dataForm.categories.forEach(i=>{a.append("categories[]",i)}),a.append("_method","POST");const l=await _.post("/file",a,{headers:{"Content-Type":"multipart/form-data"}});l.status===200?(this.closeModal(1),this.getAllFiles(),this.$showToast("success","Success",l.data.message)):this.$showToast("error","Sorry",l.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.message)}},handlePathChange(a){const l=a.target.files[0];l&&["application/pdf"].includes(l.type)?this.dataForm.path=l:(this.$showToast("error","Error","Hanya file PDF yang diizinkan."),a.target.value=null)},async getCategories(){try{const a=await _.get("/category");a.status===200?this.categories=a.data.data.map(l=>({value:l.id,title:l.name})):this.$showToast("error","Sorry","error get data division")}catch{this.$showToast("error","Sorry","error get data division")}},async getPositions(){try{const a=await _.get("/position");a.status===200?this.positions=a.data.data.map(l=>({value:l.id,title:l.name,checked:!1})):this.$showToast("error","Sorry","error get data position")}catch{this.$showToast("error","Sorry","error get data position")}},formatDate(a){return new Date(a).toLocaleString("id-ID")},async getAllFiles(){try{const a=await _.get("/file");a.status===200?this.items=a.data.data:this.$showToast("error","Sorry",a.data.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.data.message)}},resetForm(){this.dataForm={name:null,path:null,summary:null,positions:null,categories:null},this.selectedPositions=[]},closeModal(a){a===1?(this.resetForm(),this.insert=!1):a===2&&(this.resetForm(),this.edit=!1)},async openModal(a,l=null){if(a===1)this.insert=!0,await this.getPositions(),await this.getCategories();else if(a===2&&l){await this.getPositions(),await this.getCategories(),this.dataForm.id=l.id,this.dataForm.name=l.name,this.dataForm.summary=l.summary;const i=l.positions.map(f=>f.id);this.positions.forEach(f=>{f.checked=i.includes(f.value)}),this.selectedCategories=l.categories.map(f=>({value:f.id,title:f.name})),this.edit=!0}}},mounted(){this.getAllFiles()}},W={class:"d-flex justify-space-between mb-6"},X={class:"row"},Y={class:"d-flex align-center pe-2 w-25"},Z={key:0},$=m("p",null,"Kategori saat ini:",-1),ee=m("p",null,"Data file Kosong",-1),te=m("p",null,"loading data .....",-1),ae=["href"],le={class:"d-flex justify-space-between"};function se(a,l,i,f,o,c){const j=K("EasyDataTable");return d(),p("div",null,[e(F,{class:"auth-card pa-4 pt-5"},{default:t(()=>[e(O,{class:"align-left"},{default:t(()=>[e(G,{class:"text-2xl font-weight-bold"},{default:t(()=>[u(" Daftar Semua File ")]),_:1})]),_:1}),m("div",W,[m("div",X,[e(x,{color:"primary",size:"small",class:"my-3 mx-3",onClick:l[0]||(l[0]=s=>c.openModal(1))},{default:t(()=>[u(" Tambah Data ")]),_:1})]),m("div",Y,[e(D,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:o.searchValue,"onUpdate:modelValue":l[1]||(l[1]=s=>o.searchValue=s)},null,8,["modelValue"])])]),e(M,{modelValue:o.insert,"onUpdate:modelValue":l[6]||(l[6]=s=>o.insert=s),width:"auto"},{default:t(()=>[e(F,null,{title:t(()=>[u("Tambah Data")]),text:t(()=>[e(A,{onSubmit:U(c.insertData,["prevent"])},{default:t(()=>[e(g,null,{default:t(()=>[e(n,{md:"12",cols:"12"},{default:t(()=>[e(D,{placeholder:"Nama file",label:"Nama",modelValue:o.dataForm.name,"onUpdate:modelValue":l[2]||(l[2]=s=>o.dataForm.name=s),autofocus:"",rules:[o.rules.required],"prepend-icon":"mdi-file"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(I,{label:"Pilih Kategori",items:o.categories,modelValue:o.dataForm.categories,"onUpdate:modelValue":l[3]||(l[3]=s=>o.dataForm.categories=s),"prepend-icon":"mdi-file",rules:[o.rules.required],multiple:"",clearable:""},null,8,["items","modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(E,{counter:"",label:"Deskripsi Singkat",rules:o.rulesTextArea,modelValue:o.dataForm.summary,"onUpdate:modelValue":l[4]||(l[4]=s=>o.dataForm.summary=s),"prepend-icon":"mdi-comment"},null,8,["rules","modelValue"])]),_:1}),e(n,{cols:"12",md:"6"},{default:t(()=>[e(N,{accept:"application/pdf",placeholder:"Pilih File","prepend-icon":"mdi-file",rules:[o.rules.required],label:"File",onChange:c.handlePathChange},null,8,["rules","onChange"])]),_:1}),e(B,{thickness:5}),e(g,null,{default:t(()=>[e(n,{cols:"6"},{default:t(()=>[e(F,null,{title:t(()=>[u(" Pilih Jabatan : ")]),text:t(()=>[e(g,null,{default:t(()=>[(d(!0),p(y,null,V(o.positions,(s,r)=>(d(),v(n,{key:r,cols:"4"},{default:t(()=>[e(q,{modelValue:s.checked,"onUpdate:modelValue":h=>s.checked=h,label:s.title,value:s.value},null,8,["modelValue","onUpdate:modelValue","label","value"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(n,{cols:"6"},{default:t(()=>[e(F,null,{title:t(()=>[u(" Jabatan yang dipilih : ")]),text:t(()=>[e(g,null,{default:t(()=>[(d(!0),p(y,null,V(o.selectedPositions,(s,r)=>(d(),v(n,{key:r,cols:"6"},{default:t(()=>[e(L,null,{prepend:t(()=>[e(b,{icon:"mdi-check"})]),default:t(()=>[e(z,{textContent:k(s.title)},null,8,["textContent"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",class:"d-flex flex-wrap justify-end gap-4"},{default:t(()=>[e(x,{type:"submit"},{default:t(()=>[u("Simpan")]),_:1}),m("button",{type:"button",class:"btn btn-blue",onClick:l[5]||(l[5]=s=>c.closeModal(1))}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),e(M,{modelValue:o.edit,"onUpdate:modelValue":l[11]||(l[11]=s=>o.edit=s),width:"auto"},{default:t(()=>[e(F,null,{title:t(()=>[u("Update Data")]),text:t(()=>[e(A,{onSubmit:U(c.updateData,["prevent"])},{default:t(()=>[e(g,null,{default:t(()=>[e(n,{md:"12",cols:"12"},{default:t(()=>[e(D,{placeholder:"Nama file",label:"Nama",modelValue:o.dataForm.name,"onUpdate:modelValue":l[7]||(l[7]=s=>o.dataForm.name=s),autofocus:"",rules:[o.rules.required],"prepend-icon":"mdi-file"},null,8,["modelValue","rules"])]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(I,{label:"Pilih Categories",items:o.categories,modelValue:o.dataForm.categories,"onUpdate:modelValue":l[8]||(l[8]=s=>o.dataForm.categories=s),"prepend-icon":"mdi-file",multiple:"",clearable:""},null,8,["items","modelValue"]),o.selectedCategories!==null?(d(),p("div",Z,[$,e(P,{"selected-class":"text-primary",column:""},{default:t(()=>[(d(!0),p(y,null,V(o.selectedCategories,(s,r)=>(d(),p("div",{key:r},[e(w,null,{default:t(()=>[u(k(s.title),1)]),_:2},1024)]))),128))]),_:1})])):R("",!0)]),_:1}),e(n,{cols:"12",md:"12"},{default:t(()=>[e(E,{counter:"",label:"Deskripsi Singkat",rules:o.rulesTextArea,modelValue:o.dataForm.summary,"onUpdate:modelValue":l[9]||(l[9]=s=>o.dataForm.summary=s),"prepend-icon":"mdi-comment"},null,8,["rules","modelValue"])]),_:1}),e(n,{cols:"12",md:"6"},{default:t(()=>[e(N,{accept:"application/pdf",placeholder:"Pilih File","prepend-icon":"mdi-file",rules:[o.rules.required],label:"File",onChange:c.handlePathChange},null,8,["rules","onChange"])]),_:1}),e(B,{thickness:5}),e(g,null,{default:t(()=>[e(n,{cols:"6"},{default:t(()=>[e(F,null,{title:t(()=>[u(" Pilih Jabatan : ")]),text:t(()=>[e(g,null,{default:t(()=>[(d(!0),p(y,null,V(o.positions,(s,r)=>(d(),v(n,{key:r,cols:"4"},{default:t(()=>[e(q,{modelValue:s.checked,"onUpdate:modelValue":h=>s.checked=h,label:s.title,value:s.value},null,8,["modelValue","onUpdate:modelValue","label","value"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(n,{cols:"6"},{default:t(()=>[e(F,null,{title:t(()=>[u(" Jabatan yang dipilih : ")]),text:t(()=>[e(g,null,{default:t(()=>[(d(!0),p(y,null,V(o.selectedPositions,(s,r)=>(d(),v(n,{key:r,cols:"6"},{default:t(()=>[e(L,null,{prepend:t(()=>[e(b,{icon:"mdi-check"})]),default:t(()=>[e(z,{textContent:k(s.title)},null,8,["textContent"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",class:"d-flex flex-wrap justify-end gap-4"},{default:t(()=>[e(x,{type:"submit"},{default:t(()=>[u("Simpan")]),_:1}),m("button",{type:"button",class:"btn btn-blue",onClick:l[10]||(l[10]=s=>c.closeModal(2))}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),e(j,{"show-index":"",headers:o.headers,items:o.items,"search-value":o.searchValue},{"empty-message":t(()=>[ee]),loading:t(()=>[te]),"item-positions":t(s=>[e(P,{"selected-class":"text-primary",column:""},{default:t(()=>[(d(!0),p(y,null,V(s.positions,(r,h)=>(d(),p("div",{key:h},[e(w,{style:{color:"rgb(6, 84, 107)"},onClick:J=>c.toPositionId(r.id)},{default:t(()=>[u(k(r.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)]),"item-created_at":t(s=>[m("p",null,k(c.formatDate(s.created_at)),1)]),"item-path":t(s=>[m("a",{href:o.filePath+s.path,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer !important"}},[e(w,{color:"primary"},{default:t(()=>[e(b,{start:"",icon:"mdi-file"}),u(" lihat ")]),_:1})],8,ae)]),"item-operation":t(s=>[m("div",le,[e(S,{location:"top",text:"Lihat Detail File"},{activator:t(({props:r})=>[m("button",C(T(r)),[e(b,{size:"20",icon:"bx-file-find",color:"red",onClick:h=>c.toDetailFile(s)},null,8,["onClick"])],16)]),_:2},1024),e(S,{location:"top",text:"Edit File"},{activator:t(({props:r})=>[m("button",C(T(r)),[e(b,{size:"20",icon:"bx-edit",color:"blue",onClick:h=>c.openModal(2,s)},null,8,["onClick"])],16)]),_:2},1024),e(S,{location:"top",text:"Hapus File"},{activator:t(({props:r})=>[m("button",C(T(r)),[e(b,{size:"20",icon:"bx-trash",color:"red",onClick:h=>c.deleteFile(s)},null,8,["onClick"])],16)]),_:2},1024)])]),"item-categories":t(s=>[e(P,{"selected-class":"text-primary",column:""},{default:t(()=>[(d(!0),p(y,null,V(s.categories,(r,h)=>(d(),p("div",{key:h},[e(w,{style:{color:"rgb(255, 153, 0)"},onClick:J=>c.toCategoryId(r.id)},{default:t(()=>[u(k(r.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)]),_:1},8,["headers","items","search-value"])]),_:1})])}const De=H(Q,[["render",se]]);export{De as default};
