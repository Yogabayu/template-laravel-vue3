import{m}from"./axios-ba43319b.js";import{o as d,k as h,w as s,a as e,b as i,t as u,V as g,e as n,c as f,f as v,F as S,d as b,j,aw as A,l as k,au as L,aP as M,aM as N}from"./main-d206bd32.js";import{_ as E}from"./_plugin-vue_export-helper-c27b6911.js";import{V as F,c as D,d as G,b as C}from"./VCard-951bbf41.js";import{V as R}from"./VImg-d26d8ca5.js";import{V as y}from"./VSpacer-20b3e546.js";import{V as _,a as p}from"./VRow-a0ca93d7.js";import{V as T}from"./VChip-ecdcfd35.js";import{V as x}from"./VForm-1918e129.js";import{V as I}from"./VTextarea-75e88641.js";import{V as K,a as O,b as P,c as U}from"./VMenu-493147e1.js";import{V as $}from"./VDialog-be0f49f5.js";import"./VAvatar-28ee46d2.js";import"./index-d44c594b.js";import"./VCounter-fe257db8.js";import"./VDivider-72d739d6.js";import"./VOverlay-4c179814.js";import"./dialog-transition-fd0c8240.js";const z={data(){return{idFile:this.$route.params.fileId,fileUser:this.$userPhotoUrl,filePath:this.$filePath,detail:{},userData:null,categories:null,comments:null,dataForm:{id:null,file_uuid:this.$route.params.fileId,desc:null,descupdate:null},edit:!1,fav:!0}},methods:{popupEdit(a){this.dataForm.id=a.id,this.dataForm.descupdate=a.content,this.edit=!0},async favorite(){try{const a=await m.get(`/user/setfavfile/${this.idFile}`);a.status===200?(this.getDetail(this.idFile),this.$showToast("success","Success",a.data.message)):(this.getDetail(this.idFile),this.$showToast("error","Sorry",a.data.message))}catch(a){this.$showToast("error","Sorry",a.response.data.message)}},async updateComment(){try{const a=new FormData;a.append("desc",this.dataForm.descupdate),a.append("_method","PUT");const t=await m.post(`/user/editcomment/${this.dataForm.id}`,a);t.status===200?(this.resetForm(),this.getCommentFile(this.idFile),this.edit=!1,this.$showToast("success","Success",t.data.message)):this.$showToast("error","Sorry",t.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.message)}},async deleteComment(a){try{if(!window.confirm("Apakah Anda yakin ingin menghapus comment?"))return;const l=await m.delete(`/user/deletecomment/${a}`);l.status===200?(this.getCommentFile(this.idFile),this.$showToast("success","Berhasil",l.data.message)):this.$showToast("error","Sorry",l.data.message)}catch(t){this.$showToast("error","Sorry",t.response.data.message)}},formatDate(a){return new Date(a).toLocaleDateString("id-ID")},async insertData(){try{this.dataForm.desc===null&&this.$showToast("error","Sorry","komentar kosong");const a=new FormData;a.append("file_uuid",this.dataForm.file_uuid),a.append("desc",this.dataForm.desc),a.append("_method","POST");const t=await m.post("/user/sendcomment",a);t.status===200?(this.resetForm(),this.getCommentFile(this.idFile),this.$showToast("success","Success",t.data.message)):this.$showToast("error","Sorry",t.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.message)}},resetForm(){this.dataForm={id:null,file_uuid:this.$route.params.fileId,desc:null,descupdate:null}},getUserData(){const a=localStorage.getItem("userData");a&&(this.userData=JSON.parse(a))},goBack(){this.$router.go(-1)},async getDetail(a){try{const t=await m.get(`/user/file/${a}`);if(t.status===200)this.detail=t.data.data,this.categories=t.data.data.categories,this.fav=!!t.data.data.favorite,this.getUserData();else{const l=t&&t.data&&t.data.message?t.data.message:"Gagal. Silakan coba lagi.";this.$showToast("error","Sorry",l)}}catch(t){const l=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Gagal login. Silakan coba lagi.";this.$showToast("error","Sorry",l)}},async getCommentFile(a){try{const t=await m.get(`/user/commentfile/${a}`);this.comments=t.data.data.map(l=>({id:l.uuid,content:l.desc,user_type:l.user.isAdmin,name:l.user.name,position:l.user.position.name,created_at:l.created_at}))}catch(t){const l=t.response&&t.response.data&&t.response.data.message?t.response.data.message:"Gagal login. Silakan coba lagi.";this.$showToast("error","Sorry",l)}}},mounted(){this.getDetail(this.idFile),this.getUserData(),this.getCommentFile(this.idFile)}},B=a=>(M("data-v-b2c0365e"),a=a(),N(),a),J={class:"text-center"},q={class:"iframeContainer"},H={key:0},Q=["data"],W=["href"],X={key:1},Y=["data"],Z=B(()=>i("p",null,"Browser Anda tidak mendukung tampilan dokumen PDF. ",-1)),ee=[Z],te=B(()=>i("h4",{class:"my-2"},"Ringkasan",-1)),ae={class:"mt-3"},se={class:"comment-content"};function oe(a,t,l,re,o,c){return d(),h(F,{class:"mx-auto"},{default:s(()=>[e(R,{src:"https://bankarthaya.com/wp-content/uploads/2023/07/desktop-1024x576-1.jpg",height:"100px",cover:""}),e(D,null,{default:s(()=>[e(y),i("div",J,[e(_,{class:"d-flex align-center justify-center"},{default:s(()=>[i("h3",null,u(o.detail.name??"-"),1),o.fav==!0?(d(),h(g,{key:0,class:"ma-2",variant:"text",icon:"mdi-heart",color:"blue-lighten-2",onClick:c.favorite},null,8,["onClick"])):(d(),h(g,{key:1,class:"ma-2",variant:"text",icon:"mdi-heart-outline",color:"blue-lighten-2",onClick:c.favorite},null,8,["onClick"]))]),_:1})]),e(y)]),_:1}),e(G,null,{default:s(()=>[e(_,null,{default:s(()=>[e(p,null,{default:s(()=>[n(" Di upload oleh: "),e(T,null,{default:s(()=>{var r;return[n(u((r=o.detail.author)!=null&&r.name?o.detail.author.name:"-"),1)]}),_:1})]),_:1}),e(p,null,{default:s(()=>[n(" Kategori : "),(d(!0),f(S,null,v(o.categories,(r,V)=>(d(),h(T,{key:V,class:"mx-3"},{default:s(()=>[n(u(r.name),1)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(C,null,{default:s(()=>[i("p",null,"https://templatevue.yogabayuap.com/file/file/"+u(o.detail.path),1),i("div",q,[o.userData&&o.userData.canDownload?(d(),f("div",H,[i("object",{class:"responsive-iframe",data:o.filePath+o.detail.path+"#toolbar=0",type:"application/pdf"},[i("p",null,[n("Browser Anda tidak mendukung tampilan dokumen PDF. Anda dapat "),i("a",{href:o.filePath+o.detail.path},"mengunduh",8,W),n(" dokumen ini.")])],8,Q)])):(d(),f("div",X,[i("object",{class:"responsive-iframe",data:o.filePath+o.detail.path+"#toolbar=0",type:"application/pdf"},ee,8,Y)]))]),e(y),te,i("span",null,u(o.detail.summary),1),e(y),i("div",ae,[e(F,{class:"mx-auto"},{default:s(()=>[e(D,null,{default:s(()=>[n(" Komentar ")]),_:1}),o.userData&&o.userData.canComment==1?(d(),h(D,{key:0},{default:s(()=>[e(x,{onSubmit:b(c.insertData,["prevent"])},{default:s(()=>[e(_,{align:"center",justify:"center"},{default:s(()=>[e(p,{md:"10",cols:"10"},{default:s(()=>[e(I,{"bg-color":"grey-lighten-2",color:"cyan",modelValue:o.dataForm.desc,"onUpdate:modelValue":t[0]||(t[0]=r=>o.dataForm.desc=r)},null,8,["modelValue"])]),_:1}),e(p,{md:"2",cols:"2"},{default:s(()=>[e(g,{density:"compact",icon:"mdi-note-plus",type:"submit"})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})):j("",!0),e(C,null,{default:s(()=>[i("div",null,[i("div",null,[(d(!0),f(S,null,v(o.comments,(r,V)=>(d(),f("div",{key:V,class:A({"admin-comment":r.user_type==1,"user-comment":r.user_type==0})},[i("div",se,[i("p",null,u(r.content),1),e(_,{class:"justify-space-between mx-2 mb-2"},{default:s(()=>[i("small",null,u(r.name)+" - "+u(r.position),1),i("small",null,u(c.formatDate(r.created_at)),1)]),_:2},1024)]),e(K,{transition:"scale-transition"},{activator:s(({props:w})=>[e(k,L(w,{class:"ellipsis-icon"}),{default:s(()=>[n("mdi-dots-vertical")]),_:2},1040)]),default:s(()=>[e(O,null,{default:s(()=>[e(P,{color:"primary",onClick:w=>c.popupEdit(r)},{prepend:s(()=>[e(k,{icon:"mdi-edit"})]),default:s(()=>[e(U,null,{default:s(()=>[n(" edit")]),_:1})]),_:2},1032,["onClick"]),e(P,{color:"primary",onClick:w=>c.deleteComment(r.id)},{prepend:s(()=>[e(k,{icon:"mdi-trash"})]),default:s(()=>[e(U,null,{default:s(()=>[n(" hapus")]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)],2))),128))])])]),_:1})]),_:1})])]),_:1}),e($,{modelValue:o.edit,"onUpdate:modelValue":t[2]||(t[2]=r=>o.edit=r),width:"auto"},{default:s(()=>[e(F,null,{title:s(()=>[n(" Update comment ")]),text:s(()=>[e(x,{onSubmit:b(c.updateComment,["prevent"])},{default:s(()=>[e(_,{align:"center",justify:"center"},{default:s(()=>[e(p,{md:"10",cols:"10"},{default:s(()=>[e(I,{"bg-color":"grey-lighten-2",color:"cyan",modelValue:o.dataForm.descupdate,"onUpdate:modelValue":t[1]||(t[1]=r=>o.dataForm.descupdate=r)},null,8,["modelValue"])]),_:1}),e(p,{md:"2",cols:"2"},{default:s(()=>[e(g,{density:"compact",icon:"mdi-note-plus",type:"submit"})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ve=E(z,[["render",oe],["__scopeId","data-v-b2c0365e"]]);export{ve as default};
