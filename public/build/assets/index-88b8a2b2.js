import{m as k}from"./axios-e7133cbe.js";import{r as H,o as n,c as m,a as e,w as t,e as c,b as h,V as x,d as A,F as g,f as y,k as P,l as w,t as V,aa as I,j as O,a8 as T,a9 as D}from"./main-a81c62ed.js";import{_ as G}from"./_plugin-vue_export-helper-c27b6911.js";import{V as b,a as Q,c as E,b as W}from"./VCard-e4eab436.js";import{V as S}from"./VTextField-f1962c2d.js";import{V as U}from"./VDialog-a7498274.js";import{V as N}from"./VForm-89a81d25.js";import{V as F,a as d}from"./VRow-5ebbf472.js";import{V as B}from"./VSelect-c26d402a.js";import{V as L}from"./VTextarea-1f514b79.js";import{V as q}from"./VFileInput-7a4dc721.js";import{V as z}from"./VDivider-bea401a9.js";import{V as J}from"./VCheckbox-de067c4f.js";import{b as j,c as K}from"./VMenu-8719345b.js";import{a as C,V as _}from"./VChip-6258b27f.js";import{V as M}from"./VTooltip-771b4b89.js";import"./VAvatar-baa6c7ee.js";import"./VImg-93950abf.js";import"./VCounter-38925781.js";import"./index-57ed8d3e.js";import"./VOverlay-33009d1e.js";import"./dialog-transition-4634a219.js";import"./VCheckboxBtn-29d237ee.js";const X={watch:{positions:{handler(a){this.selectedPositions=a.filter(l=>l.checked).map(({title:l,value:u})=>({title:l,value:u}))},deep:!0}},data(){return{insert:!1,edit:!1,filePath:this.$filePath,rules:{required:a=>!!a||"Required"},rulesTextArea:[a=>a.length<=2048||"Max 2048 characters"],items:[],headers:[{text:"Pengunggah",value:"author.name",sortable:!0},{text:"File Name",value:"name",sortable:!0},{text:"Jabatan",value:"positions",sortable:!0},{text:"Kategori",value:"categories",sortable:!0},{text:"File",value:"path",sortable:!0},{text:"Tanggal Diupload",value:"created_at",sortable:!0},{text:"Operation    ",value:"operation"}],searchValue:"",searchField:["name","author.name","email","positions","categories"],dataForm:{id:null,name:null,path:null,summary:"",positions:[],categories:[]},positions:[],categories:[],selectedPositions:[],selectedCategories:[],uploadProgress:null,isShowDetailPos:!1,detailPos:null}},methods:{showAllPositions(a){this.detailPos=a,this.isShowDetailPos=!0},toCategoryId(a){this.$router.push(`/a-percategory/${a}`)},toPositionId(a){this.$router.push(`/a-perposition/${a}`)},toDetailFile(a){this.$router.push(`/a-filedetail/${a.id}`)},toLink(a){this.$router.push(`/${a}`)},async updateData(){try{const a=new FormData;a.append("id",this.dataForm.id),a.append("name",this.dataForm.name),a.append("summary",this.dataForm.summary),this.dataForm.path!==null&&a.append("path",this.dataForm.path),this.dataForm.positions=this.selectedPositions.map(i=>i.value),this.dataForm.positions!==null&&this.dataForm.positions.forEach(i=>{a.append("positions[]",i)}),this.dataForm.categories!==null&&this.dataForm.categories.forEach(i=>{a.append("categories[]",i)}),a.append("_method","PUT");const l={onUploadProgress:i=>{try{this.uploadProgress=Math.round(i.loaded*100/i.total)}catch(s){console.error("Error calculating progress:",s)}},headers:{"Content-Type":"multipart/form-data"}},u=await k.post(`/file/${this.dataForm.id}`,a,l);u.status===200?(this.closeModal(2),this.getAllFiles(),this.$showToast("success","Success",u.data.message)):(this.closeModal(2),this.getAllFiles(),this.$showToast("error","Sorry",u.data.message))}catch(a){console.log(a),this.closeModal(2),this.getAllFiles(),this.$showToast("error","Sorry",a.response.data.message)}},async deleteFile(a){try{if(!window.confirm("Semua Data yang terkait akan ikut terhapus. Apakah Anda yakin ingin menghapus data?"))return;const u=await k.delete(`/file/${a.id}`);u.status===200?(this.getAllFiles(),this.$showToast("success","Berhasil",u.data.message)):this.$showToast("error","Sorry",u.data.message)}catch(l){this.$showToast("error","Sorry",l.response.data.message)}},async insertData(){try{for(let i in this.dataForm)i!=="id"&&this.dataForm[i]===null&&(this.closeModal(1),this.$showToast("error","Sorry",`Properti ${i} harus diisi.`));const a=new FormData;for(let i in this.dataForm)i!=="id"&&i!=="positions"&&i!=="categories"&&a.append(i,this.dataForm[i]);this.dataForm.positions=this.selectedPositions.map(i=>i.value),this.dataForm.positions.forEach(i=>{a.append("positions[]",i)}),this.dataForm.categories.forEach(i=>{a.append("categories[]",i)}),a.append("_method","POST");const l={onUploadProgress:i=>{try{this.uploadProgress=Math.round(i.loaded*100/i.total)}catch(s){console.error("Error calculating progress:",s)}},headers:{"Content-Type":"multipart/form-data"}},u=await k.post("/file",a,l);u.status===200?(this.closeModal(1),this.getAllFiles(),this.uploadProgress=null,this.$showToast("success","Success",u.data.message)):(this.uploadProgress=null,this.$showToast("error","Sorry",u.data.message))}catch(a){this.uploadProgress=null,this.closeModal(1),this.$showToast("error","Sorry",a.response.data.message)}},handlePathChange(a){const l=a.target.files[0];l&&["application/pdf"].includes(l.type)?this.dataForm.path=l:(this.$showToast("error","Error","Hanya file PDF yang diizinkan."),a.target.value=null)},async getCategories(){try{const a=await k.get("/category");a.status===200?this.categories=a.data.data.map(l=>({value:l.id,title:l.name})):this.$showToast("error","Sorry","error get data division")}catch{this.$showToast("error","Sorry","error get data division")}},async getPositions(){try{const a=await k.get("/position");a.status===200?this.positions=a.data.data.map(l=>({value:l.id,title:l.name,checked:!1})):this.$showToast("error","Sorry","error get data position")}catch{this.$showToast("error","Sorry","error get data position")}},formatDate(a){return new Date(a).toLocaleString("id-ID")},async getAllFiles(){try{const a=await k.get("/file");a.status===200?this.items=a.data.data:this.$showToast("error","Sorry",a.data.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.data.message)}},resetForm(){this.dataForm={name:null,path:null,summary:null,positions:null,categories:null},this.selectedPositions=[]},closeModal(a){a===1?(this.resetForm(),this.insert=!1):a===2&&(this.resetForm(),this.edit=!1)},async openModal(a,l=null){if(a===1)this.insert=!0,await this.getPositions(),await this.getCategories();else if(a===2&&l){await this.getPositions(),await this.getCategories(),this.dataForm.id=l.id,this.dataForm.name=l.name,this.dataForm.summary=l.summary;const u=l.positions.map(i=>i.id);this.positions.forEach(i=>{i.checked=u.includes(i.value)}),this.selectedCategories=l.categories.map(i=>({value:i.id,title:i.name})),this.edit=!0}}},mounted(){this.getAllFiles()}},Y={class:"d-flex justify-space-between mb-6"},Z={class:"row"},$={class:"d-flex align-center pe-2 w-25"},ee={key:0},te=h("p",null,"Kategori saat ini:",-1),ae=h("p",null,"Data file Kosong",-1),le=h("p",null,"loading data .....",-1),oe=["href"],se=h("span",{class:"text-h5"},"Daftar Jabatan Terpilih",-1),ie={class:"d-flex justify-space-between"};function re(a,l,u,i,s,p){const R=H("EasyDataTable");return n(),m("div",null,[e(b,{class:"auth-card pa-4 pt-5"},{default:t(()=>[e(Q,{class:"align-left"},{default:t(()=>[e(E,{class:"text-2xl font-weight-bold"},{default:t(()=>[c(" Daftar Semua File ")]),_:1})]),_:1}),h("div",Y,[h("div",Z,[e(x,{color:"primary",size:"small",class:"my-3 mx-3",onClick:l[0]||(l[0]=o=>p.openModal(1))},{default:t(()=>[c(" Tambah Data ")]),_:1})]),h("div",$,[e(S,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:s.searchValue,"onUpdate:modelValue":l[1]||(l[1]=o=>s.searchValue=o)},null,8,["modelValue"])])]),e(U,{modelValue:s.insert,"onUpdate:modelValue":l[7]||(l[7]=o=>s.insert=o),width:"auto"},{default:t(()=>[e(b,null,{title:t(()=>[c("Tambah Data")]),text:t(()=>[e(N,{onSubmit:A(p.insertData,["prevent"])},{default:t(()=>[e(F,null,{default:t(()=>[e(d,{md:"12",cols:"12"},{default:t(()=>[e(S,{placeholder:"Nama file",label:"Nama",modelValue:s.dataForm.name,"onUpdate:modelValue":l[2]||(l[2]=o=>s.dataForm.name=o),autofocus:"",rules:[s.rules.required],"prepend-icon":"mdi-file"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(B,{label:"Pilih Kategori",items:s.categories,modelValue:s.dataForm.categories,"onUpdate:modelValue":l[3]||(l[3]=o=>s.dataForm.categories=o),"prepend-icon":"mdi-file",rules:[s.rules.required],multiple:"",clearable:""},null,8,["items","modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(L,{counter:"",label:"Deskripsi Singkat",rules:s.rulesTextArea,modelValue:s.dataForm.summary,"onUpdate:modelValue":l[4]||(l[4]=o=>s.dataForm.summary=o),"prepend-icon":"mdi-comment"},null,8,["rules","modelValue"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(q,{accept:"application/pdf",placeholder:"Pilih File","prepend-icon":"mdi-file",rules:[s.rules.required],label:"File",onChange:p.handlePathChange},null,8,["rules","onChange"])]),_:1}),e(z,{thickness:5}),e(F,null,{default:t(()=>[e(d,{cols:"6"},{default:t(()=>[e(b,null,{title:t(()=>[c(" Pilih Jabatan : ")]),text:t(()=>[e(F,null,{default:t(()=>[(n(!0),m(g,null,y(s.positions,(o,r)=>(n(),P(d,{key:r,cols:"4"},{default:t(()=>[e(J,{modelValue:o.checked,"onUpdate:modelValue":f=>o.checked=f,label:o.title,value:o.value},null,8,["modelValue","onUpdate:modelValue","label","value"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(d,{cols:"6"},{default:t(()=>[e(b,null,{title:t(()=>[c(" Jabatan yang dipilih : ")]),text:t(()=>[e(F,null,{default:t(()=>[(n(!0),m(g,null,y(s.selectedPositions,(o,r)=>(n(),P(d,{key:r,cols:"6"},{default:t(()=>[e(j,null,{prepend:t(()=>[e(w,{icon:"mdi-check"})]),default:t(()=>[e(K,{textContent:V(o.title)},null,8,["textContent"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",class:"d-flex flex-wrap justify-end gap-4"},{default:t(()=>[e(x,{type:"submit"},{default:t(()=>[c("Simpan")]),_:1}),h("button",{type:"button",class:"btn btn-blue",onClick:l[5]||(l[5]=o=>p.closeModal(1))}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),actions:t(()=>[e(I,{modelValue:s.uploadProgress,"onUpdate:modelValue":l[6]||(l[6]=o=>s.uploadProgress=o),color:"amber",height:"25"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(U,{modelValue:s.edit,"onUpdate:modelValue":l[13]||(l[13]=o=>s.edit=o),width:"auto"},{default:t(()=>[e(b,null,{title:t(()=>[c("Update Data")]),text:t(()=>[e(N,{onSubmit:A(p.updateData,["prevent"])},{default:t(()=>[e(F,null,{default:t(()=>[e(d,{md:"12",cols:"12"},{default:t(()=>[e(S,{placeholder:"Nama file",label:"Nama",modelValue:s.dataForm.name,"onUpdate:modelValue":l[8]||(l[8]=o=>s.dataForm.name=o),autofocus:"",rules:[s.rules.required],"prepend-icon":"mdi-file"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(B,{label:"Pilih Categories",items:s.categories,modelValue:s.dataForm.categories,"onUpdate:modelValue":l[9]||(l[9]=o=>s.dataForm.categories=o),"prepend-icon":"mdi-file",multiple:"",clearable:""},null,8,["items","modelValue"]),s.selectedCategories!==null?(n(),m("div",ee,[te,e(C,{"selected-class":"text-primary",column:""},{default:t(()=>[(n(!0),m(g,null,y(s.selectedCategories,(o,r)=>(n(),m("div",{key:r},[e(_,null,{default:t(()=>[c(V(o.title),1)]),_:2},1024)]))),128))]),_:1})])):O("",!0)]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(L,{counter:"",label:"Deskripsi Singkat",rules:s.rulesTextArea,modelValue:s.dataForm.summary,"onUpdate:modelValue":l[10]||(l[10]=o=>s.dataForm.summary=o),"prepend-icon":"mdi-comment"},null,8,["rules","modelValue"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(q,{accept:"application/pdf",placeholder:"Pilih File","prepend-icon":"mdi-file",rules:[s.rules.required],label:"File",onChange:p.handlePathChange},null,8,["rules","onChange"])]),_:1}),e(z,{thickness:5}),e(F,null,{default:t(()=>[e(d,{cols:"6"},{default:t(()=>[e(b,null,{title:t(()=>[c(" Pilih Jabatan : ")]),text:t(()=>[e(F,null,{default:t(()=>[(n(!0),m(g,null,y(s.positions,(o,r)=>(n(),P(d,{key:r,cols:"4"},{default:t(()=>[e(J,{modelValue:o.checked,"onUpdate:modelValue":f=>o.checked=f,label:o.title,value:o.value},null,8,["modelValue","onUpdate:modelValue","label","value"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(d,{cols:"6"},{default:t(()=>[e(b,null,{title:t(()=>[c(" Jabatan yang dipilih : ")]),text:t(()=>[e(F,null,{default:t(()=>[(n(!0),m(g,null,y(s.selectedPositions,(o,r)=>(n(),P(d,{key:r,cols:"6"},{default:t(()=>[e(j,null,{prepend:t(()=>[e(w,{icon:"mdi-check"})]),default:t(()=>[e(K,{textContent:V(o.title)},null,8,["textContent"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",class:"d-flex flex-wrap justify-end gap-4"},{default:t(()=>[e(x,{type:"submit"},{default:t(()=>[c("Simpan")]),_:1}),h("button",{type:"button",class:"btn btn-blue",onClick:l[11]||(l[11]=o=>p.closeModal(2))}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),actions:t(()=>[e(I,{modelValue:s.uploadProgress,"onUpdate:modelValue":l[12]||(l[12]=o=>s.uploadProgress=o),color:"amber",height:"25"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"]),e(R,{"show-index":"",headers:s.headers,items:s.items,"search-value":s.searchValue},{"empty-message":t(()=>[ae]),loading:t(()=>[le]),"item-created_at":t(o=>[h("p",null,V(p.formatDate(o.created_at)),1)]),"item-path":t(o=>[h("a",{href:s.filePath+o.path,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer !important"}},[e(_,{color:"primary"},{default:t(()=>[e(w,{start:"",icon:"mdi-file"}),c(" lihat ")]),_:1})],8,oe)]),"item-positions":t(o=>[e(C,{"selected-class":"text-primary",column:""},{default:t(()=>[o.positions.length<=5?(n(!0),m(g,{key:0},y(o.positions,(r,f)=>(n(),m("div",{key:f},[e(_,{style:{color:"rgb(6, 84, 107)"},onClick:v=>p.toPositionId(r.id)},{default:t(()=>[c(V(r.name),1)]),_:2},1032,["onClick"])]))),128)):(n(),m(g,{key:1},[(n(!0),m(g,null,y(o.positions.slice(0,5),(r,f)=>(n(),m("div",{key:f},[e(_,{style:{color:"rgb(6, 84, 107)"},onClick:v=>p.toPositionId(r.id)},{default:t(()=>[c(V(r.name),1)]),_:2},1032,["onClick"])]))),128)),e(_,{style:{color:"rgb(6, 84, 107)"},onClick:r=>p.showAllPositions(o)},{default:t(()=>[c(" +"+V(o.positions.length-5)+" lainnya ",1)]),_:2},1032,["onClick"]),e(U,{modelValue:s.isShowDetailPos,"onUpdate:modelValue":l[14]||(l[14]=r=>s.isShowDetailPos=r),width:"auto"},{default:t(()=>[e(b,null,{default:t(()=>[e(E,null,{default:t(()=>[se]),_:1}),e(W,null,{default:t(()=>[e(C,{"selected-class":"text-primary",column:""},{default:t(()=>[(n(!0),m(g,null,y(s.detailPos.positions,(r,f)=>(n(),m("div",{key:f},[e(_,{style:{color:"rgb(6, 84, 107)"},onClick:v=>p.toPositionId(r.id)},{default:t(()=>[c(V(r.name),1)]),_:2},1032,["onClick"])]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))]),_:2},1024)]),"item-operation":t(o=>[h("div",ie,[e(M,{location:"top",text:"Lihat Detail File"},{activator:t(({props:r})=>[h("button",T(D(r)),[e(w,{size:"20",icon:"bx-file-find",color:"red",onClick:f=>p.toDetailFile(o)},null,8,["onClick"])],16)]),_:2},1024),e(M,{location:"top",text:"Edit File"},{activator:t(({props:r})=>[h("button",T(D(r)),[e(w,{size:"20",icon:"bx-edit",color:"blue",onClick:f=>p.openModal(2,o)},null,8,["onClick"])],16)]),_:2},1024),e(M,{location:"top",text:"Hapus File"},{activator:t(({props:r})=>[h("button",T(D(r)),[e(w,{size:"20",icon:"bx-trash",color:"red",onClick:f=>p.deleteFile(o)},null,8,["onClick"])],16)]),_:2},1024)])]),"item-categories":t(o=>[e(C,{"selected-class":"text-primary",column:""},{default:t(()=>[(n(!0),m(g,null,y(o.categories,(r,f)=>(n(),m("div",{key:f},[e(_,{style:{color:"rgb(255, 153, 0)"},onClick:v=>p.toCategoryId(r.id)},{default:t(()=>[c(V(r.name),1)]),_:2},1032,["onClick"])]))),128))]),_:2},1024)]),_:1},8,["headers","items","search-value"])]),_:1})])}const Ue=G(X,[["render",re]]);export{Ue as default};
