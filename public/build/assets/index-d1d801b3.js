import{m as f}from"./axios-ba43319b.js";import{r as x,o as m,c,a as e,w as t,l as g,e as n,t as V,b as r,V as k,d as D,F as b,f as F,k as w,ax as S,ab as I}from"./main-14c84be2.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{V as y,a as M,c as U}from"./VCard-598b2702.js";import{V as P}from"./VTextField-deeea55f.js";import{V as L}from"./VDialog-9fdc6340.js";import{V as E}from"./VForm-7eeb30f5.js";import{V as _,a as d}from"./VRow-dc77a87a.js";import{V as N}from"./VSelect-31efa367.js";import{V as q}from"./VTextarea-216ab384.js";import{V as A}from"./VFileInput-c9682469.js";import{V as z}from"./VDivider-cd59ca70.js";import{V as R}from"./VCheckbox-f860a615.js";import{b as j,c as J}from"./VMenu-fd4bf83d.js";import{V as v,a as K}from"./VChip-ed3c0f3a.js";import{V as O}from"./VTooltip-7f43dd23.js";import"./VAvatar-8146ca0d.js";import"./VImg-ce5c169d.js";import"./VCounter-5b886afa.js";import"./index-051b5d86.js";import"./VOverlay-7a380e4d.js";import"./dialog-transition-472bcbf0.js";import"./VCheckboxBtn-80273715.js";const G={watch:{positions:{handler(o){this.selectedPositions=o.filter(a=>a.checked).map(({title:a,value:i})=>({title:a,value:i}))},deep:!0}},data(){return{positionId:this.$route.params.posId,positionProfile:{name:null},filePath:this.$filePath,rules:{required:o=>!!o||"Required"},rulesTextArea:[o=>o.length<=2048||"Max 2048 characters"],dataForm:{id:null,name:null,path:null,summary:"",positions:[],categories:[]},positions:[],categories:[],items:[],headers:[{text:"Pengunggah",value:"file.author.name",sortable:!0},{text:"Nama File",value:"file.name",sortable:!0},{text:"Kategori",value:"file.categories",sortable:!0},{text:"File",value:"file.path",sortable:!0},{text:"Tanggal Diupload",value:"file.created_at",sortable:!0},{text:"Operation",value:"operation"}],searchValue:"",insert:!1,selectedPositions:[],selectedCategories:[]}},methods:{formatDate(o){return new Date(o).toLocaleString("id-ID")},toLink(o){this.$router.push(`/a-filedetail/${o.files[0].id}`)},toDetailFile(o){this.$router.push(`/a-filedetail/${o.file.id}`)},async insertData(){try{for(let i in this.dataForm)i!=="id"&&this.dataForm[i]===null&&(this.closeModal(),this.$showToast("error","Sorry",`Properti ${i} harus diisi.`));const o=new FormData;for(let i in this.dataForm)i!=="id"&&i!=="positions"&&i!=="categories"&&o.append(i,this.dataForm[i]);this.dataForm.positions=this.selectedPositions.map(i=>i.value),this.dataForm.positions.forEach(i=>{o.append("positions[]",i)}),this.dataForm.categories.forEach(i=>{o.append("categories[]",i)}),o.append("_method","POST");const a=await f.post("/file",o,{headers:{"Content-Type":"multipart/form-data"}});a.status===200?(this.closeModal(),this.getAllFilePerPosition(this.positionId),this.$showToast("success","Success",a.data.message)):this.$showToast("error","Sorry",a.data.message)}catch(o){this.$showToast("error","Sorry",o.response.data.message)}},resetForm(){this.dataForm={name:null,thumbnail:null,path:null,summary:null,divisions:null,positions:null,categories:null},this.selectedPositions=[],this.selectedCategories=[]},async getCategories(){try{const o=await f.get("/category");o.status===200?this.categories=o.data.data.map(a=>({value:a.id,title:a.name})):this.$showToast("error","Sorry","error get data category")}catch{this.$showToast("error","Sorry","error get data category")}},async getPositions(){try{const o=await f.get("/position");o.status===200?this.positions=o.data.data.map(a=>({value:a.id,title:a.name})):this.$showToast("error","Sorry","error get data position")}catch{this.$showToast("error","Sorry","error get data position")}},handlePathChange(o){const a=o.target.files[0];a&&["application/pdf"].includes(a.type)?this.dataForm.path=a:(this.$showToast("error","Error","Hanya file PDF yang diizinkan."),o.target.value=null)},closeModal(){this.resetForm(),this.insert=!1},openModal(){this.getPositions(),this.getCategories(),this.insert=!0},async getAllFilePerPosition(o){try{const a=await f.get(`/fileperpositionid/${o}`);a.status===200?(this.items=a.data.data.file,this.positionProfile=a.data.data.position):this.$showToast("error","Sorry",a.data.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.message)}}},mounted(){this.getAllFilePerPosition(this.positionId)}},H={class:"d-flex justify-space-between mb-6"},Q={class:"d-flex align-center pe-2 w-25"},W=r("p",null,"Data File Jabatan Kosong",-1),X=r("p",null,"loading data .....",-1),Y=["href"],Z={class:"operation-wrapper"},$={class:"d-flex justify-space-between"};function ee(o,a,i,te,l,p){const T=x("router-link"),C=x("EasyDataTable");return m(),c("div",null,[e(y,{class:"auth-card pa-4 pt-5"},{default:t(()=>[e(M,{class:"align-left"},{default:t(()=>[e(T,{to:"/a-file",class:"back-link"},{default:t(()=>[e(g,{icon:"bx-arrow-back",color:"primary",tag:"back",start:""}),n(" Back ")]),_:1}),e(U,{class:"text-2xl font-weight-bold"},{default:t(()=>[n(" Daftar File Berdasarkan Posisi : "+V(l.positionProfile.name??"-"),1)]),_:1})]),_:1}),r("div",H,[e(k,{color:"primary",size:"small",class:"my-3 mx-3",onClick:p.openModal},{default:t(()=>[n(" Tambah Data ")]),_:1},8,["onClick"]),r("div",Q,[e(P,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:l.searchValue,"onUpdate:modelValue":a[0]||(a[0]=s=>l.searchValue=s)},null,8,["modelValue"])])]),e(L,{modelValue:l.insert,"onUpdate:modelValue":a[5]||(a[5]=s=>l.insert=s),width:"auto"},{default:t(()=>[e(y,null,{title:t(()=>[n("Tambah Data")]),text:t(()=>[e(E,{onSubmit:D(p.insertData,["prevent"])},{default:t(()=>[e(_,null,{default:t(()=>[e(d,{md:"12",cols:"12"},{default:t(()=>[e(P,{placeholder:"Nama file",label:"Nama",modelValue:l.dataForm.name,"onUpdate:modelValue":a[1]||(a[1]=s=>l.dataForm.name=s),autofocus:"",rules:[l.rules.required],"prepend-icon":"mdi-file"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(N,{label:"Pilih Kategori",items:l.categories,modelValue:l.dataForm.categories,"onUpdate:modelValue":a[2]||(a[2]=s=>l.dataForm.categories=s),"prepend-icon":"mdi-file",rules:[l.rules.required],multiple:"",clearable:""},null,8,["items","modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(q,{counter:"",label:"Deskripsi Singkat",rules:l.rulesTextArea,modelValue:l.dataForm.summary,"onUpdate:modelValue":a[3]||(a[3]=s=>l.dataForm.summary=s),"prepend-icon":"mdi-comment"},null,8,["rules","modelValue"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(A,{accept:"application/pdf",placeholder:"Pilih File","prepend-icon":"mdi-file",rules:[l.rules.required],label:"File",onChange:p.handlePathChange},null,8,["rules","onChange"])]),_:1}),e(z,{thickness:5}),e(_,null,{default:t(()=>[e(d,{cols:"6"},{default:t(()=>[e(y,null,{title:t(()=>[n(" Pilih Jabatan : ")]),text:t(()=>[e(_,null,{default:t(()=>[(m(!0),c(b,null,F(l.positions,(s,u)=>(m(),w(d,{key:u,cols:"4"},{default:t(()=>[e(R,{modelValue:s.checked,"onUpdate:modelValue":h=>s.checked=h,label:s.title,value:s.value},null,8,["modelValue","onUpdate:modelValue","label","value"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(d,{cols:"6"},{default:t(()=>[e(y,null,{title:t(()=>[n(" Jabatan yang dipilih : ")]),text:t(()=>[e(_,null,{default:t(()=>[(m(!0),c(b,null,F(l.selectedPositions,(s,u)=>(m(),w(d,{key:u,cols:"6"},{default:t(()=>[e(j,null,{prepend:t(()=>[e(g,{icon:"mdi-check"})]),default:t(()=>[e(J,{textContent:V(s.title)},null,8,["textContent"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",class:"d-flex flex-wrap justify-end gap-4"},{default:t(()=>[e(k,{type:"submit"},{default:t(()=>[n("Simpan")]),_:1}),r("button",{type:"button",class:"btn btn-blue",onClick:a[4]||(a[4]=s=>p.closeModal())}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),e(C,{"show-index":"",headers:l.headers,items:l.items,"search-value":l.searchValue},{"empty-message":t(()=>[W]),loading:t(()=>[X]),"item-file.path":t(s=>[r("a",{href:l.filePath+s.file.path,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer !important"}},[e(v,{color:"primary"},{default:t(()=>[e(g,{start:"",icon:"mdi-file"}),n(" lihat ")]),_:1})],8,Y)]),"item-file.categories":t(s=>[e(K,{"selected-class":"text-primary",column:""},{default:t(()=>[(m(!0),c(b,null,F(s.file.categories,(u,h)=>(m(),c("div",{key:h},[e(v,{style:{color:"rgb(255, 153, 0)"}},{default:t(()=>[n(V(u.name),1)]),_:2},1024)]))),128))]),_:2},1024)]),"item-file.created_at":t(s=>[r("p",null,V(p.formatDate(s.file.created_at)),1)]),"item-operation":t(s=>[r("div",Z,[r("div",$,[e(O,{location:"top",text:"Lihat Detail File"},{activator:t(({props:u})=>[r("button",S(I(u)),[e(g,{size:"20",icon:"bx-file-find",color:"red",onClick:h=>p.toDetailFile(s)},null,8,["onClick"])],16)]),_:2},1024)])])]),_:1},8,["headers","items","search-value"])]),_:1})])}const Pe=B(G,[["render",ee]]);export{Pe as default};
