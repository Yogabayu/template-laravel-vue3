import{m as f}from"./axios-e7133cbe.js";import{r as x,o as m,c as p,a as e,w as t,l as g,e as n,t as y,b as i,V as w,d as D,F as b,f as F,k,a8 as S,a9 as I}from"./main-a81c62ed.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{V,a as M,c as U}from"./VCard-e4eab436.js";import{V as v}from"./VTextField-f1962c2d.js";import{V as E}from"./VDialog-a7498274.js";import{V as L}from"./VForm-89a81d25.js";import{V as _,a as d}from"./VRow-5ebbf472.js";import{V as N}from"./VSelect-c26d402a.js";import{V as q}from"./VTextarea-1f514b79.js";import{V as A}from"./VFileInput-7a4dc721.js";import{V as K}from"./VDivider-bea401a9.js";import{V as z}from"./VCheckbox-de067c4f.js";import{b as R,c as j}from"./VMenu-8719345b.js";import{V as C,a as J}from"./VChip-6258b27f.js";import{V as O}from"./VTooltip-771b4b89.js";import"./VAvatar-baa6c7ee.js";import"./VImg-93950abf.js";import"./VCounter-38925781.js";import"./index-57ed8d3e.js";import"./VOverlay-33009d1e.js";import"./dialog-transition-4634a219.js";import"./VCheckboxBtn-29d237ee.js";const G={watch:{positions:{handler(o){this.selectedPositions=o.filter(a=>a.checked).map(({title:a,value:s})=>({title:a,value:s}))},deep:!0}},data(){return{categoryId:this.$route.params.catId,categoryProfile:{name:null},filePath:this.$filePath,rules:{required:o=>!!o||"Required"},rulesTextArea:[o=>o.length<=2048||"Max 2048 characters"],dataForm:{id:null,name:null,path:null,summary:"",positions:[],categories:[]},positions:[],categories:[],items:[],headers:[{text:"Pengunggah",value:"file.author.name",sortable:!0},{text:"Nama File",value:"file.name",sortable:!0},{text:"Kategori",value:"file.positions",sortable:!0},{text:"File",value:"file.path",sortable:!0},{text:"Tanggal Diupload",value:"file.created_at",sortable:!0},{text:"Operation",value:"operation"}],searchValue:"",insert:!1,selectedPositions:[],selectedCategories:[]}},methods:{formatDate(o){return new Date(o).toLocaleString("id-ID")},toDetailFile(o){this.$router.push(`/a-filedetail/${o.file.id}`)},async insertData(){try{for(let s in this.dataForm)s!=="id"&&this.dataForm[s]===null&&(this.closeModal(),this.$showToast("error","Sorry",`Properti ${s} harus diisi.`));const o=new FormData;for(let s in this.dataForm)s!=="id"&&s!=="positions"&&s!=="categories"&&o.append(s,this.dataForm[s]);this.dataForm.positions=this.selectedPositions.map(s=>s.value),this.dataForm.positions.forEach(s=>{o.append("positions[]",s)}),this.dataForm.categories.forEach(s=>{o.append("categories[]",s)}),o.append("_method","POST");const a=await f.post("/file",o,{headers:{"Content-Type":"multipart/form-data"}});a.status===200?(this.closeModal(),this.getAllFilePerCategory(this.categoryId),this.$showToast("success","Success",a.data.message)):this.$showToast("error","Sorry",a.data.message)}catch(o){this.$showToast("error","Sorry",o.response.data.message)}},resetForm(){this.dataForm={name:null,thumbnail:null,path:null,summary:null,divisions:null,positions:null,categories:null},this.selectedPositions=[],this.selectedCategories=[]},async getCategories(){try{const o=await f.get("/category");o.status===200?this.categories=o.data.data.map(a=>({value:a.id,title:a.name})):this.$showToast("error","Sorry","error get data category")}catch{this.$showToast("error","Sorry","error get data category")}},async getPositions(){try{const o=await f.get("/position");o.status===200?this.positions=o.data.data.map(a=>({value:a.id,title:a.name})):this.$showToast("error","Sorry","error get data position")}catch{this.$showToast("error","Sorry","error get data position")}},handlePathChange(o){const a=o.target.files[0];a&&["application/pdf"].includes(a.type)?this.dataForm.path=a:(this.$showToast("error","Error","Hanya file PDF yang diizinkan."),o.target.value=null)},closeModal(){this.resetForm(),this.insert=!1},openModal(){this.getPositions(),this.getCategories(),this.insert=!0},async getAllFilePerCategory(o){try{const a=await f.get(`/filepercategoryid/${o}`);a.status===200?(this.items=a.data.data.file,this.categoryProfile=a.data.data.category):this.$showToast("error","Sorry",a.data.data.message)}catch(a){this.$showToast("error","Sorry",a.response.data.message)}}},mounted(){this.getAllFilePerCategory(this.categoryId)}},H={class:"d-flex justify-space-between mb-6"},Q={class:"d-flex align-center pe-2 w-25"},W=i("p",null,"Data File Kategori Kosong",-1),X=i("p",null,"loading data .....",-1),Y=["href"],Z={class:"operation-wrapper"},$={class:"d-flex justify-space-between"};function ee(o,a,s,te,r,c){const T=x("router-link"),P=x("EasyDataTable");return m(),p("div",null,[e(V,{class:"auth-card pa-4 pt-5"},{default:t(()=>[e(M,{class:"align-left"},{default:t(()=>[e(T,{to:"/a-file",class:"back-link"},{default:t(()=>[e(g,{icon:"bx-arrow-back",color:"primary",tag:"back",start:""}),n(" Back ")]),_:1}),e(U,{class:"text-2xl font-weight-bold"},{default:t(()=>[n(" Daftar File Berdasarkan Kategori : "+y(r.categoryProfile.name??"-"),1)]),_:1})]),_:1}),i("div",H,[e(w,{color:"primary",size:"small",class:"my-3 mx-3",onClick:c.openModal},{default:t(()=>[n(" Tambah Data ")]),_:1},8,["onClick"]),i("div",Q,[e(v,{"prepend-inner-icon":"mdi-magnify",density:"compact",label:"Search","single-line":"",flat:"","hide-details":"",variant:"solo-filled",modelValue:r.searchValue,"onUpdate:modelValue":a[0]||(a[0]=l=>r.searchValue=l)},null,8,["modelValue"])])]),e(E,{modelValue:r.insert,"onUpdate:modelValue":a[5]||(a[5]=l=>r.insert=l),width:"auto"},{default:t(()=>[e(V,null,{title:t(()=>[n("Tambah Data")]),text:t(()=>[e(L,{onSubmit:D(c.insertData,["prevent"])},{default:t(()=>[e(_,null,{default:t(()=>[e(d,{md:"12",cols:"12"},{default:t(()=>[e(v,{placeholder:"Nama file",label:"Nama",modelValue:r.dataForm.name,"onUpdate:modelValue":a[1]||(a[1]=l=>r.dataForm.name=l),autofocus:"",rules:[r.rules.required],"prepend-icon":"mdi-file"},null,8,["modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(N,{label:"Pilih Kategori",items:r.categories,modelValue:r.dataForm.categories,"onUpdate:modelValue":a[2]||(a[2]=l=>r.dataForm.categories=l),"prepend-icon":"mdi-file",rules:[r.rules.required],multiple:"",clearable:""},null,8,["items","modelValue","rules"])]),_:1}),e(d,{cols:"12",md:"12"},{default:t(()=>[e(q,{counter:"",label:"Deskripsi Singkat",rules:r.rulesTextArea,modelValue:r.dataForm.summary,"onUpdate:modelValue":a[3]||(a[3]=l=>r.dataForm.summary=l),"prepend-icon":"mdi-comment"},null,8,["rules","modelValue"])]),_:1}),e(d,{cols:"12",md:"6"},{default:t(()=>[e(A,{accept:"application/pdf",placeholder:"Pilih File","prepend-icon":"mdi-file",rules:[r.rules.required],label:"File",onChange:c.handlePathChange},null,8,["rules","onChange"])]),_:1}),e(K,{thickness:5}),e(_,null,{default:t(()=>[e(d,{cols:"6"},{default:t(()=>[e(V,null,{title:t(()=>[n(" Pilih Jabatan : ")]),text:t(()=>[e(_,null,{default:t(()=>[(m(!0),p(b,null,F(r.positions,(l,u)=>(m(),k(d,{key:u,cols:"4"},{default:t(()=>[e(z,{modelValue:l.checked,"onUpdate:modelValue":h=>l.checked=h,label:l.title,value:l.value},null,8,["modelValue","onUpdate:modelValue","label","value"])]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(d,{cols:"6"},{default:t(()=>[e(V,null,{title:t(()=>[n(" Jabatan yang dipilih : ")]),text:t(()=>[e(_,null,{default:t(()=>[(m(!0),p(b,null,F(r.selectedPositions,(l,u)=>(m(),k(d,{key:u,cols:"6"},{default:t(()=>[e(R,null,{prepend:t(()=>[e(g,{icon:"mdi-check"})]),default:t(()=>[e(j,{textContent:y(l.title)},null,8,["textContent"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{cols:"12",class:"d-flex flex-wrap justify-end gap-4"},{default:t(()=>[e(w,{type:"submit"},{default:t(()=>[n("Simpan")]),_:1}),i("button",{type:"button",class:"btn btn-blue",onClick:a[4]||(a[4]=l=>c.closeModal())}," Batal ")]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),e(P,{"show-index":"",headers:r.headers,items:r.items,"search-value":r.searchValue},{"empty-message":t(()=>[W]),loading:t(()=>[X]),"item-file.path":t(l=>[i("a",{href:r.filePath+l.file.path,target:"_blank",rel:"noopener noreferrer",style:{cursor:"pointer !important"}},[e(C,{color:"primary"},{default:t(()=>[e(g,{start:"",icon:"mdi-file"}),n(" lihat ")]),_:1})],8,Y)]),"item-file.positions":t(l=>[e(J,{"selected-class":"text-primary",column:""},{default:t(()=>[(m(!0),p(b,null,F(l.file.positions,(u,h)=>(m(),p("div",{key:h},[e(C,{style:{color:"rgb(255, 153, 0)"}},{default:t(()=>[n(y(u.name),1)]),_:2},1024)]))),128))]),_:2},1024)]),"item-file.created_at":t(l=>[i("p",null,y(c.formatDate(l.file.created_at)),1)]),"item-operation":t(l=>[i("div",Z,[i("div",$,[e(O,{location:"top",text:"Lihat Detail File"},{activator:t(({props:u})=>[i("button",S(I(u)),[e(g,{size:"20",icon:"bx-file-find",color:"red",onClick:h=>c.toDetailFile(l)},null,8,["onClick"])],16)]),_:2},1024)])])]),_:1},8,["headers","items","search-value"])]),_:1})])}const ve=B(G,[["render",ee]]);export{ve as default};
